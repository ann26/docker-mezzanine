{% extends "shop/checkout.html" %}
{% load staticfiles i18n mezzanine_tags %}

{% block extra_head %}
    {{ block.super }}
    <script src="{% static "cartridge/js/shipping_fields.js" %}"></script>
{% endblock %}

{% block fields %}
    {% if request.cart.has_items %}
        {% if not request.user.is_authenticated %}
            {% ifinstalled mezzanine.accounts %}
                <p>
                    {% url "login" as login_url %}
                    {% url "signup" as signup_url %}
                    {% with request.path as next %}
                        {% blocktrans %}
                            If you have an existing account or would like to create one, please
                            <a href="{{ login_url }}?next={{ next }}">log in</a> or
                            <a href="{{ signup_url }}?next={{ next }}">sign up</a>.
                        {% endblocktrans %}
                    {% endwith %}
                </p>
            {% endifinstalled %}
        {% endif %}

        {% errors_for form %}

        <fieldset>
            <legend>{% trans "Billing Details" %}</legend>
            {% fields_for form.billing_detail_fields %}
        </fieldset>

        <fieldset>
            <legend>{% trans "Delivery Details" %}</legend>
            {% fields_for form.same_billing_shipping_field %}
            <div id="shipping_fields">{% fields_for form.shipping_detail_fields %}</div>
            {% fields_for form.additional_instructions_field %}
            {% fields_for form.remember_field %}
        </fieldset>

        {% if not settings.SHOP_CHECKOUT_STEPS_SPLIT and settings.SHOP_PAYMENT_STEP_ENABLED %}
            {% include "shop/includes/payment_fields.html" %}
        {% endif %}

        {% fields_for form.other_fields %}

    {% endif %}
{% endblock %}


{% block extra_js %}
    <script>
        {# additional script to add label for billing information #}
        {# Check if div already contain label #}
        $(document).ready(function () {
            {# First Name #}
            $('div.input_id_billing_detail_first_name').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('First Name');
                    $(this).prepend($label);
                }
            });
            {# Last Name #}
            $('div.input_id_billing_detail_last_name').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('Last Name');
                    $(this).prepend($label);
                }
            });

            {# Street #}
            $('div.input_id_billing_detail_street').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('Street');
                    $(this).prepend($label);
                }
            });

            {# City #}
            $('div.input_id_billing_detail_city').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('City');
                    $(this).prepend($label);
                }
            });

            {# State #}
            $('div.input_id_billing_detail_state').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('State');
                    $(this).prepend($label);
                }
            });

            {# PostCode #}
            $('div.input_id_billing_detail_postcode').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('Post Code');
                    $(this).prepend($label);
                }
            });

            {# Country #}
            $('div.input_id_billing_detail_country').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('Country');
                    $(this).prepend($label);
                }
            });

            {# Phone #}
            $('div.input_id_billing_detail_phone').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('Phone');
                    $(this).prepend($label);
                }
            });

            {# Email #}
            $('div.input_id_billing_detail_email').each(function() {
                if ($(this).find('> label').length == 0) {
                    var $label = $("<label>").text('Email');
                    $(this).prepend($label);
                }
            });

        });
    </script>
    <script>
        $(document).ready(function () {
            var phone_pattern = '^0.*$';
            {# billing #}
            $phone_label = $('.input_id_billing_detail_phone label');
            $phone_label.html($phone_label.html() + " <i>(with leading 0)</i>");
            $phone_input = $('.input_id_billing_detail_phone input');
            $phone_input.attr('pattern', phone_pattern);
            {# shipping #}
            $phone_label = $('.input_id_shipping_detail_phone label');
            $phone_label.html($phone_label.html() + " <i>(with leading 0)</i>");
            $phone_input = $('.input_id_shipping_detail_phone input');
            $phone_input.attr('pattern', phone_pattern);
        });
    </script>

{% endblock %}